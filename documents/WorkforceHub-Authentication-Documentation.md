# WorkforceHub Authentication Documentation

This document provides detailed information about the authentication system, token implementation, and database schema for the WorkforceHub application.

## Table of Contents

1. [Authentication System](#authentication-system)
   - [Registration Process](#registration-process)
   - [Login Process](#login-process)
   - [Security Implementation](#security-implementation)
2. [JWT Token Implementation](#jwt-token-implementation)
   - [Token Generation](#token-generation)
   - [Token Validation](#token-validation)
   - [Token Structure](#token-structure)
3. [API Endpoints](#api-endpoints)
   - [Authentication Endpoints](#authentication-endpoints)
   - [User Management Endpoints](#user-management-endpoints)
4. [Database Schema](#database-schema)
   - [User Table](#user-table)
   - [Roles and Permissions](#roles-and-permissions)
   - [Entity Relationships](#entity-relationships)

## Authentication System

The WorkforceHub application implements a secure authentication system using Spring Security and JSON Web Tokens (JWT). This system provides a stateless authentication mechanism that allows users to safely access the application's resources.

### Registration Process

1. **User Information Collection**: The registration process starts with collecting essential user information through the `/api/auth/register` endpoint.

2. **Validation**: The system validates the provided information:
   - Checks if the username is already taken
   - Verifies if the email is already in use
   - Validates required fields

3. **Password Security**: User passwords are securely hashed using BCrypt before storing in the database, ensuring that raw passwords are never saved.

4. **Account Creation**: Upon successful validation, a new user account is created in the database.

#### Registration Request Example:

```json
POST /api/auth/register
Content-Type: application/json

{
  "firstName": "John",
  "lastName": "Doe",
  "username": "johndoe",
  "email": "john.doe@example.com",
  "password": "password123"
}
```

#### Registration Response Example:

```json
HTTP/1.1 201 Created
Content-Type: application/json

{
  "id": 1,
  "firstName": "John",
  "lastName": "Doe",
  "username": "johndoe",
  "email": "john.doe@example.com"
}
```

### Login Process

1. **Credential Submission**: Users submit their email and password to the `/api/auth/login` endpoint.

2. **Authentication**: The system authenticates the user credentials:
   - Retrieves the user by email from the database
   - Verifies the submitted password against the stored hashed password

3. **Token Generation**: Upon successful authentication, the system generates a JWT token for the user.

4. **Response**: The system returns the JWT token along with the user's information.

#### Login Request Example:

```json
POST /api/auth/login
Content-Type: application/json

{
  "email": "john.doe@example.com",
  "password": "password123"
}
```

#### Login Response Example:

```json
HTTP/1.1 200 OK
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "firstName": "John",
    "lastName": "Doe",
    "username": "johndoe",
    "email": "john.doe@example.com"
  }
}
```

### Security Implementation

The application uses Spring Security for implementing authentication and authorization:

- **CSRF Protection**: CSRF protection is disabled for API endpoints since JWT provides protection against CSRF attacks.
- **CORS Configuration**: CORS is configured to allow requests from any origin with standard HTTP methods.
- **Stateless Session Management**: The application uses stateless session management with JWT tokens.
- **Password Encoding**: BCryptPasswordEncoder is used for password hashing.

## JWT Token Implementation

JSON Web Tokens (JWT) are used for maintaining user sessions and securing API endpoints.

### Token Generation

Tokens are generated by the JwtTokenProvider class that:

1. Creates a JWT with the following information:
   - Subject: User's email
   - Issuance date: Current timestamp
   - Expiration date: Current timestamp + expiration time (configurable, default is 24 hours)
   - Claims: Additional user information (if needed)

2. Signs the token with a secret key defined in the application properties.

### Token Validation

The application validates tokens through the JwtAuthenticationFilter that:

1. Extracts the JWT from the Authorization header of incoming requests.
2. Verifies the token signature using the same secret key.
3. Ensures the token is not expired.
4. Loads the user details based on the username extracted from the token.
5. Sets the authentication in the Spring Security context if the token is valid.

### Token Structure

Each JWT consists of three parts separated by dots (`.`):

1. **Header**: Contains the type of token and the signing algorithm.
   ```json
   {
     "alg": "HS256",
     "typ": "JWT"
   }
   ```

2. **Payload**: Contains the claims (user email, expiration time, etc.).
   ```json
   {
     "sub": "john.doe@example.com",
     "iat": 1683047400,
     "exp": 1683133800
   }
   ```

3. **Signature**: Verifies that the message wasn't changed along the way.
   ```
   HMACSHA256(
     base64UrlEncode(header) + "." +
     base64UrlEncode(payload),
     secret
   )
   ```

## API Endpoints

### Authentication Endpoints

| Endpoint | Method | Description | Request Body | Response |
|----------|--------|-------------|--------------|----------|
| `/api/auth/register` | POST | Register a new user | UserRegistrationDTO | UserDTO |
| `/api/auth/login` | POST | Login and get authentication token | LoginRequestDTO | LoginResponseDTO |

### User Management Endpoints

| Endpoint | Method | Description | Auth Required | Request/Path Param | Response |
|----------|--------|-------------|---------------|-------------------|----------|
| `/api/users` | GET | Get all users | Yes | None | List<UserDTO> |
| `/api/users/{id}` | GET | Get user by ID | Yes | User ID | UserDTO |
| `/api/users/{id}` | PUT | Update user | Yes | User ID & UserRegistrationDTO | UserDTO |
| `/api/users/{id}` | DELETE | Delete user | Yes | User ID | None (204 No Content) |

## Database Schema

### User Table

The WorkforceHub application uses PostgreSQL as its database system. The main user table structure is:

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);